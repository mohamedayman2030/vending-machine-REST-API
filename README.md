# 🥤 Vending Machine API

This is a secure, reliable, and extensible RESTful API for a **Vending Machine** system. It supports two user roles: **seller** and **buyer**, allowing sellers to manage products and buyers to deposit coins and purchase products.

---

## 🚀 Features

- ✅ RESTful JSON API
- ✅ Role-Based Access Control (RBAC)
- ✅ JWT Authentication
- ✅ Secure password encryption using **bcrypt**
- ✅ Full **ACID-compliant** transactions using Sequelize and Postgres
- ✅ Product locking during purchase to prevent race conditions
- ✅ Dockerized setup with PostgreSQL
- ✅ Middleware validation with **Joi**
- ✅ Postman collection with automated AI-written test cases

---

## 📦 Project Structure

```
/models         → Sequelize models for User, Product
/controllers    → Handles business logic
/routes         → Defines REST endpoints
/middlewares    → JWT Auth, RBAC, Joi Validation
/validators     → Joi schemas for each entity
/migrations     → Sequelize migration files
/tests          → Postman collection
```

---

## 🛠️ Setup & Run

### 1. Environment Variables

Create a `.env` file based on the following structure:

```
DB_USER=postgres
DB_PASSWORD=postgres
DB_NAME=vending_db
DB_HOST=postgres
JWT_SECRET=your_jwt_secret
```

### 2. Run the App

```bash
docker-compose up --build
```

The API will be running at:  
**http://localhost:3000**

---

## 🔐 Authentication & Authorization

- Users authenticate using `username` and `password` (hashed using **bcrypt**).
- All secured endpoints require a valid JWT.
- Role-Based Access Control (RBAC):
  - **Sellers** can create, update, delete **their own products**
  - **Buyers** can deposit, buy, reset only their own account

---

## 💰 Buyer-Specific Endpoints

| Endpoint      | Description                                      |
|---------------|--------------------------------------------------|
| POST /deposit | Accepts 5, 10, 20, 50, 100 cent coins only       |
| POST /buy     | Buys product(s), returns total, product, change |
| POST /reset   | Resets buyer's deposit to 0                      |

---

## 🧪 API Testing

All endpoints are covered in the attached **Postman collection**, automatically generated by an AI agent.

👉 [Postman Test Collection](#insert-link-here)

---

## 🔮 Suggested Future Improvements

1. **Caching**  
   Use Redis or similar for frequent product and user queries.

2. **Monitoring**  
   Integrate tools like **Datadog**, **Prometheus**, or **Sentry** for observability.

3. **LLM Agent Integration**  
   Add an LLM-based agent to interact with users (e.g., “What’s the cheapest snack I can buy?”).

---

## 📚 Summary of Requirements

- REST API in JSON
- CRUD for:
  - Users (auth-free registration, secured updates/deletes)
  - Products (public read, sellers can manage their own)
- Buyers:
  - Deposit coins: 5, 10, 20, 50, 100 only
  - Purchase products (with coin change)
  - Reset their deposit
- Authorization by role
- All sensitive operations locked in **transactions**

---

## 📜 License

MIT — use freely, just give credit if this project helps you.
